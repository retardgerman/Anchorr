<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anchorr</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css" />
    <link rel="icon" href="assets/logo.png" type="image/png" />
  </head>
  <body class="auth-mode">
    <div class="content-wrapper">
      <nav class="navbar">
        <div class="container">
          <a href="#" class="navbar-brand">
            <img src="/assets/logo-text.png" alt="Anchorr Logo" class="logo" />
          </a>
          <ul class="nav-links">
            <li>
              <a href="#" class="about-link" data-target="about">About</a>
            </li>
            <li>
              <a
                href="https://github.com/nairdahh/Anchorr"
                target="_blank"
                rel="noopener noreferrer"
                >GitHub</a
              >
            </li>
            <li>
              <a href="#" id="logout-btn" style="display: none;">Logout</a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Shared Hero Section -->
      <header id="main-hero" class="hero full-screen">
        <div class="container">
          <div class="hero-aurora"></div>
          <div class="page-content">
            <div class="hero-content">
              <!-- Auth Text -->
              <div id="hero-text-auth">
                <h1 class="hero-title">Anchorr</h1>
                <p class="hero-subtitle">
                  Secure, self-hosted bridge for your media server.
                </p>
              </div>

              <!-- Dashboard Text -->
              <div id="hero-text-dashboard" style="display: none;">
                <h1 class="hero-title">Anchorr Configuration</h1>
                <p class="hero-subtitle">
                  Anchorr needs to be connect with your Discord bot and with your
                  Jellyfin and Jellyseerr instances.
                  <br />
                  Below is a step-by-step walkthrough to help you set up
                  everything you need to get started!
                </p>
              </div>
              
              <!-- Auth Forms Container -->
              <div id="auth-container-wrapper" class="auth-container">
                <!-- Login Form -->
                <form id="login-form" class="auth-form">
                  <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" required placeholder="Enter your username">
                  </div>
                  <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required placeholder="Enter your password">
                  </div>
                  <button type="submit" class="btn btn-primary" style="width: 100%; margin: 0;">Login</button>
                  <p class="auth-switch">
                    Don't have an account? <a href="#" id="show-register">Register</a>
                  </p>
                </form>

                <!-- Register Form -->
                <form id="register-form" class="auth-form" style="display: none;">
                  <div class="form-group">
                    <label for="register-username">Choose Username</label>
                    <input type="text" id="register-username" required placeholder="Choose a username">
                  </div>
                  <div class="form-group">
                    <label for="register-password">Choose Password</label>
                    <input type="password" id="register-password" required placeholder="Choose a secure password">
                  </div>
                  <button type="submit" class="btn btn-primary" style="width: 100%; margin: 0;">Create Account</button>
                  <p class="auth-switch">
                    Already have an account? <a href="#" id="show-login">Login</a>
                  </p>
                </form>
                <div id="auth-error" class="auth-error"></div>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Dashboard Content (Initially Hidden) -->
      <main id="dashboard-content" class="page-content" style="flex-grow: 1; display: none;">
        <section id="setup" class="setup-section">
          <div class="container">
            <div
              class="dashboard-header"
            >
              <h2
                class="dashboard-title"
                id="dashboard-title"
              >
                Configuration
              </h2>
              <button type="button" id="bot-control-btn" class="btn btn-status btn-danger">
                <i class="bi bi-play-fill"></i>
                <span id="bot-control-text">Start Bot</span>
              </button>
            </div>

            <div class="dashboard-layout">
              <div class="dashboard-sidebar">
                <nav class="dashboard-nav">
                  <a href="#" class="nav-item active" data-target="discord">1. Discord</a>
                  <a href="#" class="nav-item" data-target="jellyseerr">2. Jellyseerr</a>
                  <a href="#" class="nav-item" data-target="media">3. Media Databases</a>
                  <a href="#" class="nav-item" data-target="jellyfin">4. Jellyfin Notifications</a>
                  <a href="#" class="nav-item" data-target="mappings">5. User Mapping</a>
                  <a href="#" class="nav-item" data-target="roles">6. Role Permissions</a>
                  <a href="#" class="nav-item" data-target="misc">7. Miscellaneous</a>
                  <button type="submit" form="config-form" class="btn btn-primary">Save Settings</button>
                </nav>
              </div>


              <div class="dashboard-content">
                <form id="config-form">
                  <!-- Discord Pane -->
                  <div id="config-pane-discord" class="config-pane active">
                    <fieldset>
                      <legend>Discord Settings</legend>
                      
                      <!-- Discord Bot Setup Instructions -->
                      <div class="setup-instructions-box">
                        <p class="setup-instructions-intro">
                          First, you need to create a Discord application for the bot. Access 
                          <a href="https://discord.com/developers/applications" target="_blank" rel="noopener noreferrer">Discord Developer Portal</a> 
                          and log in. Create a new application, then:
                        </p>
                        <ol class="setup-instructions-list">
                          <li>
                            Go to <strong>"Bot"</strong> in the sidebar and click <strong>"Add Bot"</strong>
                          </li>
                          <li>
                            In the <strong>"Bot"</strong> section, scroll down to <strong>"Privileged Gateway Intents"</strong> and enable <code>SERVER MEMBERS INTENT</code> (required for user mappings feature)
                          </li>
                          <li>
                            Go to <strong>"OAuth2"</strong> → <strong>"URL Generator"</strong>
                          </li>
                          <li>
                            Select scopes: <code>bot</code> and <code>applications.commands</code>
                          </li>
                          <li>
                            Select permissions: <code>Send Messages</code> and <code>Embed Links</code>
                          </li>
                          <li>
                            Copy the generated URL, open it in your browser, and authorize the bot on your Discord server
                          </li>
                          <li>
                            Come back here and fill in the <strong>Discord Bot Token</strong> and <strong>Bot Client ID</strong> below, then select your server and notification channel from the dropdowns
                          </li>
                        </ol>
                      </div>

                      <div class="form-group">
                        <label for="DISCORD_TOKEN">Discord Bot Token</label>
                        <input
                          type="password"
                          id="DISCORD_TOKEN"
                          name="DISCORD_TOKEN"
                          placeholder="MTQyNTkwNTDwedRFAoYzMDAyMzEyNzSwoR.GHh1xM..."
                        />
                        <div class="form-text">
                          The secret token of your bot from the
                          <a
                            href="https://discord.com/developers/applications"
                            target="_blank"
                            rel="noopener noreferrer"
                            >Discord Developer Portal</a
                          >
                          -&gt; Bot -&gt; Reset Token
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="BOT_ID">Bot Client ID</label>
                        <input
                          type="text"
                          id="BOT_ID"
                          name="BOT_ID"
                          placeholder="1455304670023657132"
                        />
                        <div class="form-text">
                          The application's client ID from the
                          <a
                            href="https://discord.com/developers/applications"
                            target="_blank"
                            rel="noopener noreferrer"
                            >Discord Developer Portal</a
                          >
                          -&gt; OAuth2 -&gt; Client ID
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="GUILD_ID">Discord Server</label>
                        <select 
                          id="GUILD_ID" 
                          name="GUILD_ID"
                          style="width: 100%; background-color: var(--background); border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                          <option value="">Loading servers...</option>
                        </select>
                        <div class="form-text">
                          Select the Discord server where the bot will operate. Make sure you've added the bot to your server first.
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="JELLYFIN_CHANNEL_ID">Default Notification Channel</label>
                        <select
                          id="JELLYFIN_CHANNEL_ID"
                          name="JELLYFIN_CHANNEL_ID"
                          style="width: 100%; background-color: var(--background); border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                          <option value="">Select a server first...</option>
                        </select>
                        <div class="form-text">
                          Select the default Discord channel for Jellyfin notifications. You can override this per-library in Step 4. Choose a server above first.
                        </div>
                      </div>

                    </fieldset>
                  </div>

                  <!-- Jellyseerr Pane -->
                  <div id="config-pane-jellyseerr" class="config-pane">
                    <fieldset>
                      <legend>Jellyseerr Settings</legend>
                      <div class="form-group">
                        <label for="JELLYSEERR_URL">Jellyseerr URL</label>
                        <input
                          type="text"
                          id="JELLYSEERR_URL"
                          name="JELLYSEERR_URL"
                          placeholder="http://localhost:5055"
                        />
                        <div class="form-text">
                          The full URL of your Jellyseerr instance.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="JELLYSEERR_API_KEY"
                          >Jellyseerr API Key</label
                        >
                        <input
                          type="password"
                          id="JELLYSEERR_API_KEY"
                          name="JELLYSEERR_API_KEY"
                          placeholder="MTc2MjA6WDN0ODc5NPAWNDEwLEO2LWRjMGMtNDEzMS1iNzQ3LPljQTg6YpQ5Yzg2Nw=="
                        />
                        <div class="form-text">
                          Your API key from Jellyseerr settings
                        </div>
                      </div>
                      <div class="form-group">
                        <button type="button" id="test-jellyseerr-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem;">Test Connection</button>
                        <span
                          id="test-jellyseerr-status"
                          style="margin-left: 1rem;"
                        ></span>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Media Databases Pane -->
                  <div id="config-pane-media" class="config-pane">
                    <fieldset>
                      <legend>Media Database Settings</legend>
                      <div class="form-group">
                        <label for="TMDB_API_KEY">TMDB API Key</label>
                        <input
                          type="text"
                          id="TMDB_API_KEY"
                          name="TMDB_API_KEY"
                          placeholder="f94a3e627b8a545201e2531b62087b47"
                        />
                        <div class="form-text">
                          A 
                          <a
                            href="https://www.themoviedb.org/settings/api"
                            target="_blank"
                            rel="noopener noreferrer"
                            >TMDB API Key</a
                          >
                          is required for searching and fetching
                          movie/show details. Found in the
                          <a
                            href="https://www.themoviedb.org/settings/api"
                            target="_blank"
                            rel="noopener noreferrer"
                            >API settings page of your TMDB account</a
                          >
                          after you log in.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="OMDB_API_KEY"
                          >OMDb API Key (Optional)</label
                        >
                        <input
                          type="text"
                          id="OMDB_API_KEY"
                          name="OMDB_API_KEY"
                          placeholder="e23eb6be"
                        />
                        <div class="form-text">
                          Optional, but recommended for richer data like ratings
                          and directors. Create one on the
                          <a
                            href="https://www.omdbapi.com/apikey.aspx"
                            target="_blank"
                            rel="noopener noreferrer"
                            >API Key page of OMDb</a
                          >.
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Jellyfin Notifications Pane -->
                  <div id="config-pane-jellyfin" class="config-pane">
                    <fieldset>
                      <legend>Jellyfin Notification Settings</legend>
                      <div class="form-group">
                        <label for="JELLYFIN_BASE_URL"
                          >Jellyfin Public URL</label
                        >
                        <input
                          type="text"
                          id="JELLYFIN_BASE_URL"
                          name="JELLYFIN_BASE_URL"
                          placeholder="http://jellyfin.yourdomain.com  |  http://192.168.1.1:8096"
                        />
                        <div class="form-text">
                          The public URL of your Jellyfin server. Used for the
                          "Watch Now" button.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="JELLYFIN_API_KEY"
                          >Jellyfin API Key</label
                        >
                        <input
                          type="password"
                          id="JELLYFIN_API_KEY"
                          name="JELLYFIN_API_KEY"
                          placeholder="c4b6b3c8f1d4f0a8a6c2e4d8f1b3c7a9"
                        />
                        <div class="form-text">
                          API key for your Jellyfin server. Generate one in Jellyfin Dashboard → Administration → API Keys. Required for loading libraries and enhanced features.
                        </div>
                      </div>
                      <div class="form-group">
                        <button type="button" id="test-jellyfin-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem;">Test Endpoint</button>
                        <span
                          id="test-jellyfin-status"
                          style="margin-left: 1rem;"
                        ></span>
                        <div class="form-text" style="margin-top: 0.5rem;">
                          Testing the endpoint successfully will automatically populate the Jellyfin Server ID field.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="JELLYFIN_SERVER_ID"
                          >Jellyfin Server ID</label
                        >
                        <input
                          type="text"
                          id="JELLYFIN_SERVER_ID"
                          name="JELLYFIN_SERVER_ID"
                          placeholder="c1507dcd594b404a8e668ba38f8eaa0c"
                        />
                        <div class="form-text">
                          Used for redirecting to the correct path of your
                          Jellyfin server media page when using the "Watch Now"
                          button. You can find this in your Jellyfin URL when
                          viewing the page of any movie or show from your
                          library.
                        </div>
                      </div>

                      <!-- Episode Debouncing Section -->
                      <div class="form-group" style="margin-top: 1.5rem;">
                        <label for="WEBHOOK_DEBOUNCE_SECONDS" style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          Episode Notification Debounce
                        </label>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                          <div style="position: relative; display: inline-block;">
                            <input
                              type="number"
                              id="WEBHOOK_DEBOUNCE_SECONDS"
                              value="60"
                              min="1"
                              max="600"
                              step="1"
                              style="width: 60px; background-color: var(--surface0); border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem 3rem 0.75rem 1rem; border-radius: 8px; font-size: 1rem; font-weight: 500; appearance: textfield; -moz-appearance: textfield;"
                            />
                            <style>
                              #WEBHOOK_DEBOUNCE_SECONDS::-webkit-outer-spin-button,
                              #WEBHOOK_DEBOUNCE_SECONDS::-webkit-inner-spin-button {
                                -webkit-appearance: none;
                                margin: 0;
                              }
                              .debounce-arrows {
                                position: absolute;
                                right: 8px;
                                top: 50%;
                                transform: translateY(-50%);
                                display: flex;
                                gap: 4px;
                              }
                              .debounce-arrow {
                                width: 24px;
                                height: 24px;
                                background-color: var(--surface1);
                                border: 1px solid var(--surface2);
                                border-radius: 4px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                cursor: pointer;
                                transition: all 0.2s ease;
                                user-select: none;
                              }
                              .debounce-arrow:hover {
                                background-color: var(--surface2);
                                border-color: var(--mauve);
                              }
                              .debounce-arrow:active {
                                background-color: var(--mauve);
                                transform: scale(0.95);
                              }
                              .debounce-arrow svg {
                                width: 12px;
                                height: 12px;
                                fill: var(--text);
                              }
                              .debounce-arrow:hover svg {
                                fill: var(--mauve);
                              }
                              .debounce-arrow:active svg {
                                fill: var(--crust);
                              }
                            </style>
                            <div class="debounce-arrows">
                              <div class="debounce-arrow" id="debounce-down" title="Decrease">
                                <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/></svg>
                              </div>
                              <div class="debounce-arrow" id="debounce-up" title="Increase">
                                <svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
                              </div>
                            </div>
                          </div>
                          <span style="color: var(--subtext0); font-weight: 500; font-size: 1rem;">seconds <span style="opacity: 0.7; font-size: 0.9rem;">(range: 1 second - 10 minutes)</span></span>
                        </div>
                        <input type="hidden" id="WEBHOOK_DEBOUNCE_MS" name="WEBHOOK_DEBOUNCE_MS" value="60000" />
                        <div class="form-text" style="margin-top: 0.5rem;">
                          Debounce function to determine how long to wait before sending notifications for multiple episodes/seasons, bundling them into a single notification message.
                        </div>
                      </div>

                      <!-- Library Notifications Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          <strong>Library Channel Mapping</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;">
                          Map specific Jellyfin libraries to different Discord channels.
                          <br>
                          <small style="color: var(--subtext0);">
                            Click "Fetch Libraries" to load your libraries, then select a channel for each one.
                            <br><strong>Note:</strong> Unchecked libraries will not send any notifications.
                          </small>
                        </div>
                        <button type="button" id="fetch-libraries-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem; margin: 0 0 1rem 0; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;">
                          <i class="bi bi-arrow-clockwise"></i> Fetch Libraries
                        </button>
                        <span id="fetch-libraries-status" style="margin-left: 1rem;"></span>
                        
                        <div id="libraries-list" class="libraries-container">
                          <!-- Populated dynamically -->
                        </div>
                        <input type="hidden" id="JELLYFIN_NOTIFICATION_LIBRARIES" name="JELLYFIN_NOTIFICATION_LIBRARIES" />
                      </div>

                      <!-- Webhook Section -->
                      <div id="webhook-section" class="webhook-box" style="margin-top: 2rem;">
                        <h3 class="webhook-title">Your Jellyfin Webhook URL</h3>
                        <div class="webhook-content">
                          <p>
                            To receive notifications, add this URL to your <strong class="emphasis-mauve">Jellyfin Webhooks plugin</strong> settings:
                          </p>
                          <div class="webhook-url-container">
                            <code id="webhook-url" class="code-block"></code>
                            <button
                              type="button"
                              id="copy-webhook-btn"
                              class="btn btn-secondary"
                            >Copy URL</button>
                          </div>
                          <p style="margin-top: 0.75rem; font-size: 0.9rem; opacity: 0.8;">
                            <strong>Note:</strong> If you're running Anchorr in Docker, you may need to replace <code>localhost</code> with your server's IP address.
                          </p>
                          <p style="margin-top: 1.5rem;">If you don't have the plugin installed, access the <strong class="emphasis-mauve">Plugins page</strong> in your <strong class="emphasis-mauve">Jellyfin Dashboard</strong>, search for <strong class="emphasis-mauve">Webhook</strong>, install it and restart the server.</p>
                          <p>After the reset, access your <strong class="emphasis-mauve">Webhook plugin settings</strong> and <strong class="emphasis-mauve">Add Discord Destination</strong>.</p>
                          <ol style="padding-left: 1.5rem; opacity: 0.9;">
                            <li>Complete the <strong class="emphasis-mauve">Server Url</strong> with your Jellyfin server's base URL.</li>
                            <li>Insert the previously specified URL in the <strong class="emphasis-mauve">Webhook Url</strong> field.</li>
                            <li><strong class="emphasis-mauve">Status</strong> must be <strong class="emphasis-mauve">Enabled</strong>.</li>
                            <li>For <strong class="emphasis-mauve">Notification Type</strong> enable <strong class="emphasis-mauve">Item Added</strong>.</li>
                            <li>For <strong class="emphasis-mauve">Item Type</strong> select your desired content you want to receive notifications for.</li>
                            <li>Enable <strong class="emphasis-mauve">Send All Properties</strong>.</li>
                            <li><strong class="emphasis-mauve">Save</strong>.</li>
                          </ol>
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Network Pane -->
                  <!-- User Mappings Pane -->
                  <div id="config-pane-mappings" class="config-pane">
                    <fieldset>
                      <legend>User Mapping</legend>
                      <p class="form-text" style="margin-bottom: 1.5rem;">
                        Map Discord users to their Jellyseerr accounts. When a user makes a request from Discord, it will be associated with their Jellyseerr account instead of the API key owner.
                      </p>
                      
                      <div id="mappings-container">
                        <div class="mappings-list" id="mappings-list">
                          <!-- Mappings will be populated here -->
                        </div>
                        
                        <div class="add-mapping-form" style="margin-top: 1.5rem;">
                          <h4 style="font-size: 1.1rem; margin-bottom: 1rem; color: var(--mauve);">Add New Mapping</h4>
                          <div class="form-group">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                              <label for="discord-user-select" style="margin-bottom: 0;">Discord User</label>
                              <button type="button" id="refresh-discord-users-btn" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 0.4rem; margin: 0;">
                                <i class="bi bi-arrow-clockwise"></i> Refresh Users
                              </button>
                            </div>
                            <div class="custom-select" id="discord-user-select">
                              <input type="text" class="custom-select-trigger" placeholder="Search Discord users..." readonly />
                              <i class="bi bi-chevron-down custom-select-chevron"></i>
                              <div class="custom-select-dropdown">
                                <div class="custom-select-options">
                                  <!-- Options will be populated here -->
                                </div>
                              </div>
                            </div>
                            <div class="form-text">
                              Select a Discord server member
                            </div>
                          </div>
                          <div class="form-group">
                            <label for="jellyseerr-user-select">Jellyseerr User</label>
                            <div class="custom-select" id="jellyseerr-user-select">
                              <input type="text" class="custom-select-trigger" placeholder="Search Jellyseerr users..." readonly />
                              <i class="bi bi-chevron-down custom-select-chevron"></i>
                              <div class="custom-select-dropdown">
                                <div class="custom-select-options">
                                  <!-- Options will be populated here -->
                                </div>
                              </div>
                            </div>
                            <div class="form-text">
                              Select the corresponding Jellyseerr account
                            </div>
                          </div>
                          <button type="button" id="add-mapping-btn" class="btn btn-primary" style="margin-left: 0;">Add Mapping</button>
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Role Permissions Pane -->
                  <div id="config-pane-roles" class="config-pane">
                    <fieldset>
                      <legend>Role Permissions</legend>
                      <p class="form-text" style="margin-bottom: 1.5rem;">
                        Control who can use bot commands by configuring role-based permissions. If no roles are selected in the allowlist, everyone can use commands. If any role is added to the blocklist, members with that role will be blocked regardless of allowlist settings.
                      </p>
                      
                      <div class="form-group">
                        <label style="font-weight: 600; color: var(--green);">Allowlist (Allow Only These Roles)</label>
                        <div id="allowlist-roles" class="role-list">
                          <p class="form-text" style="opacity: 0.7; font-style: italic;">Loading roles...</p>
                        </div>
                        <div class="form-text">
                          If empty, all members can use commands. If roles are selected, only members with these roles can use commands.
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label style="font-weight: 600; color: var(--peach);">Blocklist (Block These Roles)</label>
                        <div id="blocklist-roles" class="role-list">
                          <p class="form-text" style="opacity: 0.7; font-style: italic;">Loading roles...</p>
                        </div>
                        <div class="form-text">
                          Members with these roles will never be able to use bot commands, even if they have an allowed role.
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Miscellaneous Pane -->
                  <div id="config-pane-misc" class="config-pane">
                    <fieldset>
                      <legend>Miscellaneous Settings</legend>
                      <p class="form-text" style="margin-bottom: 1.5rem;">
                        Optional settings to enhance your bot experience. These are extra features that can be enabled after your bot is fully configured and running.
                      </p>
                      
                      <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                          <input type="checkbox" id="AUTO_START_BOT" name="AUTO_START_BOT" />
                          Auto-start bot on server boot
                        </label>
                        <div class="form-text">
                          If enabled, the bot starts automatically when the container/server restarts and valid Discord credentials are present.
                        </div>
                      </div>

                      <div class="form-group" style="margin-top: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                          <input type="checkbox" id="NOTIFY_ON_AVAILABLE" name="NOTIFY_ON_AVAILABLE" />
                          Send PM when request is available
                        </label>
                        <div class="form-text">
                          When enabled, users will receive a private message when their requested content becomes available on Jellyfin.
                        </div>
                      </div>

                      <div class="form-group" style="margin-top: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                          <input type="checkbox" id="PRIVATE_MESSAGE_MODE" name="PRIVATE_MESSAGE_MODE" />
                          Ephemeral Message Mode
                        </label>
                        <div class="form-text">
                          When enabled, all bot responses (search and request results) are sent as ephemeral messages (only visible to the user who used the command). When disabled, successful results are visible to everyone in the channel, but warning messages (e.g., "already on Jellyfin") are always ephemeral.
                        </div>
                      </div>
                    </fieldset>
                  </div>

                </form>
              </div>
          </div>

          <!-- About Page (Independent) -->
          <div id="about-page" class="about-page" style="display: none;">
            <div class="about-content">
              <h2>About Anchorr</h2>
              <p class="about-description">
                <strong class="anchor-highlight">Anchorr</strong> is a self-hosted, lightweight bridge that connects your <strong>Jellyfin</strong> media server with <strong>Discord</strong>. It notifies you on a dedicated channel when new media is added to your library, and with <strong>Jellyseerr</strong> integration, you can search and request movies and shows directly from Discord.
              </p>

              <div class="features-list">
                <h3 class="features-title">Features</h3>
                <ul>
                  <li><i class="bi bi-search"></i><div><code>/search &lt;title&gt;</code> Search for a movie or show with auto-suggestions. An embed with detailed information is shown, from which you can request the media. For TV shows, you have the option to select the desired seasons for the request.</div></li>
                  <li><i class="bi bi-send-fill"></i><div><code>/request &lt;title&gt;</code> Instantly send a request for your chosen movie or show directly to Jellyseerr. For TV shows, this automatically requests all seasons.</div></li>
                  <li><i class="bi bi-bell-fill"></i><div>Receive beautifully formatted notifications on your selected Discord channel whenever new media is added to your Jellyfin library.</div></li>
                  <li><i class="bi bi-film"></i><div>Using the TMDB and OMDb databases, Discord messages get a beautiful and well-structured look, with essential information about the requested or added media content.</div></li>
                  <li><i class="bi bi-sliders"></i><div>Control permissions with role-based access (allowlist/blocklist), route notifications to different channels by Jellyfin library, and link users to Jellyseerr accounts for accurate request tracking.</div></li>
                  <li><i class="bi bi-chat-left-dots"></i><div>Get direct messages on Discord when requested content becomes available in your library. Never miss when your requests are ready!</div></li>
                </ul>
              </div>

              <div class="about-cards">
                <div class="about-card support-card">
                  <i class="bi bi-heart-fill"></i>
                  <h3>Support the Project</h3>
                  <p>If you find Anchorr useful, consider supporting its development. Every coffee helps fuel late-night coding sessions!</p>
                  <a href="https://ko-fi.com/nairdah" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">Buy me a Coffee</a>
                </div>
                <div class="about-card">
                  <i class="bi bi-github"></i>
                  <h3>Contribute</h3>
                  <p>Anchorr is open-source! If you're a developer, your contributions are welcome. Check out the project on GitHub to get started.</p>
                  <a href="https://github.com/nairdahh/Anchorr" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">View on GitHub</a>
                </div>
              </div>

              <div class="dev-footer">
                <div class="dev-footer-left">
                  <a href="https://github.com/nairdahh" target="_blank" rel="noopener noreferrer">
                    <img src="/assets/nairdah_avatar.jpeg" alt="nairdah's avatar" class="dev-avatar">
                  </a>
                  <div class="dev-info">
                    <span>Created & Maintained by</span>
                    <a href="https://github.com/nairdahh" target="_blank" rel="noopener noreferrer" class="dev-link">nairdah</a>
                  </div>
                </div>
                <div class="dev-footer-right">
                  <p>Thank you for using Anchorr!<br>Please contact me for any matter about the project.</p>
                </div>
              </div>

            </div>
          </div>

        </section>
      </main>

      <!-- Logs Section -->
      <section id="logs-section" class="setup-section" style="display: none;">
        <div class="container">
          <div style="margin-bottom: 1rem; flex-shrink: 0;">
            <button type="button" id="back-to-config-btn">
              ← Back to Configuration
            </button>
          </div>

          <div class="dashboard-header">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <button type="button" class="logs-tab-btn active" data-target="all">
                All Logs
              </button>
              <button type="button" class="logs-tab-btn" data-target="error">
                Errors
              </button>
              <button type="button" id="refresh-logs-btn" class="logs-tab-btn" title="Refresh logs">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </div>
            <div style="display: flex; align-items: center; gap: 1.5rem;">
              <!-- Status Indicators -->
              <div class="status-indicator-container">
                <div class="status-indicator-item">
                  <div id="jellyseerr-status-indicator" class="status-dot"></div>
                  <span>Jellyseerr</span>
                </div>
                <div class="status-indicator-item">
                  <div id="jellyfin-status-indicator" class="status-dot"></div>
                  <span>Jellyfin</span>
                </div>
              </div>
              <button type="button" id="bot-control-btn-logs" class="btn btn-status btn-danger">
                <i class="bi bi-play-fill"></i>
                <span id="bot-control-text-logs">Start Bot</span>
              </button>
            </div>
          </div>

          <div id="logs-container">
            <div style="text-align: center; color: var(--subtext0); padding: 2rem;">
              Loading logs...
            </div>
          </div>
        </div>
      </section>

      </main>

      <footer class="footer">
        <div
          class="container"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <div class="footer-links" style="margin-top: 0">
            <a
              href="https://github.com/nairdahh/Anchorr"
              target="_blank"
              rel="noopener noreferrer"
              >GitHub</a
            >
            <a
              href="https://github.com/nairdahh/Anchorr/issues"
              target="_blank"
              rel="noopener noreferrer"
              >Report a Bug</a
            >
            <button id="logs-page-btn" class="footer-btn">Logs</button>
          </div>
          <div>
            made by
            <a
              href="https://github.com/nairdahh"
              target="_blank"
              rel="noopener noreferrer"
              >nairdah</a
            >
            ❤️
            <a
              href="https://ko-fi.com/nairdah"
              target="_blank"
              rel="noopener noreferrer"
              >Buy me a Coffee!</a
            >
          </div>
        </div>
      </footer>

    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
    <script src="script.js"></script>
    <script>
      // Initialize Coloris globally on page load
      document.addEventListener("DOMContentLoaded", () => {
        Coloris({
          el: "[data-coloris]",
          theme: "large",
          themeMode: "dark",
          format: "hex",
          swatches: [
            "#cba6f7", // Mauve
            "#89b4fa", // Blue
            "#a6e3a1", // Green
            "#ef9f76", // Peach
            "#f38ba8", // Red
            "#f9e2af", // Yellow
          ],
        });

        // Sync debounce seconds input with milliseconds hidden field
        const secondsInput = document.getElementById('WEBHOOK_DEBOUNCE_SECONDS');
        const msInput = document.getElementById('WEBHOOK_DEBOUNCE_MS');
        const upArrow = document.getElementById('debounce-up');
        const downArrow = document.getElementById('debounce-down');
        
        if (secondsInput && msInput) {
          // Convert seconds to milliseconds on input
          secondsInput.addEventListener('input', function() {
            let seconds = parseInt(this.value) || 60;
            // Clamp to valid range
            if (seconds < 1) seconds = 1;
            if (seconds > 600) seconds = 600;
            this.value = seconds;
            msInput.value = seconds * 1000;
          });
          
          // Hold-to-repeat functionality
          let repeatInterval = null;
          let repeatTimeout = null;
          
          const startRepeat = function(direction) {
            const increment = function() {
              let current = parseInt(secondsInput.value) || 60;
              if (direction === 'up' && current < 600) {
                secondsInput.value = current + 1;
                msInput.value = (current + 1) * 1000;
              } else if (direction === 'down' && current > 1) {
                secondsInput.value = current - 1;
                msInput.value = (current - 1) * 1000;
              }
            };
            
            // Immediate increment on first click
            increment();
            
            // Start repeating after 300ms delay at max speed (50ms interval)
            repeatTimeout = setTimeout(function() {
              repeatInterval = setInterval(increment, 50);
            }, 300);
          };
          
          const stopRepeat = function() {
            if (repeatTimeout) {
              clearTimeout(repeatTimeout);
              repeatTimeout = null;
            }
            if (repeatInterval) {
              clearInterval(repeatInterval);
              repeatInterval = null;
            }
          };
          
          // Up arrow events
          if (upArrow) {
            upArrow.addEventListener('mousedown', () => startRepeat('up'));
            upArrow.addEventListener('mouseup', stopRepeat);
            upArrow.addEventListener('mouseleave', stopRepeat);
            upArrow.addEventListener('touchstart', (e) => {
              e.preventDefault();
              startRepeat('up');
            });
            upArrow.addEventListener('touchend', stopRepeat);
          }
          
          // Down arrow events
          if (downArrow) {
            downArrow.addEventListener('mousedown', () => startRepeat('down'));
            downArrow.addEventListener('mouseup', stopRepeat);
            downArrow.addEventListener('mouseleave', stopRepeat);
            downArrow.addEventListener('touchstart', (e) => {
              e.preventDefault();
              startRepeat('down');
            });
            downArrow.addEventListener('touchend', stopRepeat);
          }
          
          // Convert milliseconds to seconds when loading config
          // This runs when the config is loaded from the server
          const updateSecondsFromMs = function() {
            const ms = parseInt(msInput.value);
            if (!isNaN(ms) && ms > 0) {
              const seconds = Math.round(ms / 1000);
              secondsInput.value = seconds;
            }
          };
          
          // Watch for changes to the hidden field (when config loads)
          const observer = new MutationObserver(updateSecondsFromMs);
          observer.observe(msInput, { attributes: true, attributeFilter: ['value'] });
          
          // Also update immediately if there's already a value
          updateSecondsFromMs();
        }
      });
    </script>
  </body>
</html>
