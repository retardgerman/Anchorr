<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anchorr</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css" />
    <link rel="icon" href="assets/logo.png" type="image/png" />
  </head>
  <body class="auth-mode">
    <div class="content-wrapper">
      <nav class="navbar">
        <div class="container">
          <a href="#" class="navbar-brand">
            <img src="/assets/logo-text.png" alt="Anchorr Logo" class="logo" />
          </a>
          <ul class="nav-links">
            <li>
              <a href="#" class="about-link" data-target="about">
                <i class="bi bi-info-circle-fill nav-icon" aria-hidden="true"></i>
                <span>About</span>
              </a>
            </li>
            <li>
              <a href="https://discord.gg/S5JrsZe9mB" target="_blank" rel="noopener noreferrer">
                <i class="bi bi-discord nav-icon" aria-hidden="true"></i>
                <span>Discord</span>
              </a>
            </li>
            <li>
              <a
                href="https://github.com/nairdahh/Anchorr"
                target="_blank"
                rel="noopener noreferrer"
              >
                <i class="bi bi-github nav-icon" aria-hidden="true"></i>
                <span>GitHub</span>
              </a>
            </li>
            <li>
              <a href="#" id="logout-btn" class="hidden">
                <i class="bi bi-box-arrow-right nav-icon" aria-hidden="true"></i>
                <span>Logout</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Shared Hero Section -->
      <header id="main-hero" class="hero full-screen no-animate">
        <div class="container">
          <div class="hero-aurora"></div>
          <!-- Hide Header Button -->
          <button id="hide-header-btn" class="hide-header-btn" title="Hide header" data-i18n="ui.hide_header" data-i18n-attr="title">
            <i class="bi bi-chevron-up"></i>
          </button>
          <div class="page-content">
            <div class="hero-content">
              <!-- Auth Text -->
              <div id="hero-text-auth">
                <h1 class="hero-title">Anchorr</h1>
                <p class="hero-subtitle">
                  Secure, self-hosted bridge for your media server.
                </p>
              </div>

              <!-- Dashboard Text -->
              <div id="hero-text-dashboard" style="display: none;">
                <h1 class="hero-title" data-i18n="dashboard.title">Anchorr Configuration</h1>
                <p class="hero-subtitle">
                  <span data-i18n="dashboard.subtitle">Anchorr needs to be connect with your Discord bot and with your
                  Jellyfin and Jellyseerr instances.</span>
                  <br />
                  <span data-i18n="dashboard.subtitle_detail">Below is a step-by-step walkthrough to help you set up
                  everything you need to get started!</span>
                </p>
              </div>
              
              <!-- Auth Forms Container -->
              <div id="auth-container-wrapper" class="auth-container">
                <!-- Language Selection (shown during auth) -->
                <div class="language-selector-auth" style="margin-bottom: 1.5rem; text-align: center;">
                  <label for="auth-language" style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--subtext0);">Language / Sprache</label>
                  <select id="auth-language" style="width: 100%; max-width: 200px; background-color: var(--surface0); border: 1px solid var(--surface1); color: var(--text); padding: 0.5rem; border-radius: 8px; font-size: 0.9rem;">
                    <!-- Languages will be populated dynamically -->
                  </select>
                </div>
                
                <!-- Login Form -->
                <form id="login-form" class="auth-form">
                  <div class="form-group">
                    <label for="login-username" data-i18n="common.username">Username</label>
                    <input type="text" id="login-username" required placeholder="Enter your username" data-i18n="auth.enter_username">
                  </div>
                  <div class="form-group">
                    <label for="login-password" data-i18n="common.password">Password</label>
                    <input type="password" id="login-password" required placeholder="Enter your password" data-i18n="auth.enter_password">
                  </div>
                  <button type="submit" class="btn btn-primary" style="width: 100%; margin: 0;" data-i18n="auth.login">Login</button>
                  <p class="auth-switch">
                    <span data-i18n="auth.no_account">Don't have an account?</span> <a href="#" id="show-register" data-i18n="auth.register">Register</a>
                  </p>
                </form>

                <!-- Register Form -->
                <form id="register-form" class="auth-form" style="display: none;">
                  <div class="form-group">
                    <label for="register-username" data-i18n="auth.choose_username">Choose Username</label>
                    <input type="text" id="register-username" required placeholder="Choose a username" data-i18n="auth.choose_username_placeholder">
                  </div>
                  <div class="form-group">
                    <label for="register-password" data-i18n="auth.choose_password">Choose Password</label>
                    <input type="password" id="register-password" required placeholder="Choose a secure password" data-i18n="auth.choose_password_placeholder">
                  </div>
                  <button type="submit" class="btn btn-primary" style="width: 100%; margin: 0;" data-i18n="auth.create_account">Create Account</button>
                  <p class="auth-switch">
                    <span data-i18n="auth.have_account">Already have an account?</span> <a href="#" id="show-login" data-i18n="auth.login">Login</a>
                  </p>
                </form>
                <div id="auth-error" class="auth-error"></div>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Show Header Button (outside hero, hidden by default) -->
      <button id="show-header-btn" class="show-header-btn" title="Show header" style="display: none;" data-i18n="ui.show_header" data-i18n-attr="title">
        <i class="bi bi-chevron-down"></i>
      </button>

      <!-- Dashboard Content (Initially Hidden) -->
      <main id="dashboard-content" class="page-content" style="flex-grow: 1; display: none;">
        <section id="setup" class="setup-section">
          <div class="container">
            <div
              class="dashboard-header"
            >
              <h2
                class="dashboard-title"
                id="dashboard-title"
                data-i18n="config.title"
              >
                Configuration
              </h2>
              <button type="button" id="bot-control-btn" class="btn btn-status btn-danger">
                <i class="bi bi-play-fill"></i>
                <span id="bot-control-text" data-i18n="config.start_bot">Start Bot</span>
              </button>
            </div>

            <div class="dashboard-layout">
              <div class="dashboard-sidebar">
                <nav class="dashboard-nav">
                  <a href="#" class="nav-item active" data-target="discord" data-i18n="config.nav_discord">1. Discord</a>
                  <a href="#" class="nav-item" data-target="jellyseerr" data-i18n="config.nav_jellyseerr">2. Jellyseerr</a>
                  <a href="#" class="nav-item" data-target="media" data-i18n="config.nav_media">3. Media Databases</a>
                  <a href="#" class="nav-item" data-target="jellyfin" data-i18n="config.nav_jellyfin">4. Jellyfin Notifications</a>
                  <a href="#" class="nav-item" data-target="mappings" data-i18n="config.nav_mappings">5. User Mapping</a>
                  <a href="#" class="nav-item" data-target="roles" data-i18n="config.nav_roles">6. Role Permissions</a>
                  <a href="#" class="nav-item" data-target="misc" data-i18n="config.nav_misc">7. Miscellaneous</a>
                  <button type="submit" form="config-form" class="btn btn-primary" data-i18n="config.save_button">Save Settings</button>
                </nav>
              </div>


              <div class="dashboard-content">
                <form id="config-form">
                  <!-- Discord Pane -->
                  <div id="config-pane-discord" class="config-pane active">
                    <fieldset>
                      <legend data-i18n="config.discord_section">Discord Settings</legend>
                      
                      <!-- Discord Bot Setup Instructions -->
                      <div class="setup-instructions-box">
                        <p class="setup-instructions-intro" data-i18n="config.discord_instructions_intro">
                          First, you need to create a Discord application for the bot. Access 
                          <a href="https://discord.com/developers/applications" target="_blank" rel="noopener noreferrer">Discord Developer Portal</a> 
                          and log in. Create a new application, then:
                        </p>
                        <ol class="setup-instructions-list">
                          <li data-i18n="config.discord_instructions_1">
                            Go to <strong>"Bot"</strong> in the sidebar and click <strong>"Add Bot"</strong>
                          </li>
                          <li data-i18n="config.discord_instructions_2">
                            In the <strong>"Bot"</strong> section, scroll down to <strong>"Privileged Gateway Intents"</strong> and enable <code>SERVER MEMBERS INTENT</code> (required for user mappings feature)
                          </li>
                          <li data-i18n="config.discord_instructions_3">
                            Go to <strong>"OAuth2"</strong> â†’ <strong>"URL Generator"</strong>
                          </li>
                          <li data-i18n="config.discord_instructions_4">
                            Select scopes: <code>bot</code> and <code>applications.commands</code>
                          </li>
                          <li data-i18n="config.discord_instructions_5">
                            Select permissions: <code>Send Messages</code> and <code>Embed Links</code>
                          </li>
                          <li data-i18n="config.discord_instructions_6">
                            Copy the generated URL, open it in your browser, and authorize the bot on your Discord server
                          </li>
                          <li data-i18n="config.discord_instructions_7">
                            Come back here and fill in the <strong>Discord Bot Token</strong> and <strong>Bot Client ID</strong> below, <strong>save your settings</strong>, <strong>start the bot</strong>, and then select your server and notification channel from the dropdowns
                          </li>
                        </ol>
                      </div>

                      <div class="form-group">
                        <label for="DISCORD_TOKEN" data-i18n="config.discord_token">Discord Bot Token</label>
                        <input
                          type="password"
                          id="DISCORD_TOKEN"
                          name="DISCORD_TOKEN"
                          placeholder="MTQyNTkwNT**********************GHh1xM..."
                        />
                        <div class="form-text" data-i18n="config.discord_token_help">
                          The secret token of your bot from the
                          <a
                            href="https://discord.com/developers/applications"
                            target="_blank"
                            rel="noopener noreferrer"
                            >Discord Developer Portal</a
                          >
                          -&gt; Bot -&gt; Reset Token
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="BOT_ID" data-i18n="config.bot_id">Bot Client ID</label>
                        <input
                          type="text"
                          id="BOT_ID"
                          name="BOT_ID"
                          placeholder="1455304670023657132"
                        />
                        <div class="form-text" data-i18n="config.bot_id_help">
                          The application's client ID from the
                          <a
                            href="https://discord.com/developers/applications"
                            target="_blank"
                            rel="noopener noreferrer"
                            >Discord Developer Portal</a
                          >
                          -&gt; OAuth2 -&gt; Client ID
                        </div>
                      </div>

                      <!-- Important Note Box -->
                      <div class="setup-instructions-box" style="background: linear-gradient(135deg, rgba(203, 166, 247, 0.1) 0%, rgba(137, 180, 250, 0.1) 100%); border-left: 4px solid var(--mauve); margin: 1.5rem 0;">
                        <p style="margin: 0; font-weight: 600; color: var(--mauve); display: flex; align-items: center; gap: 0.5rem;">
                          <i class="bi bi-info-circle-fill"></i>
                          <span data-i18n="config.next_steps_title">Next Steps</span>
                        </p>
                        <ol style="margin: 0.75rem 0 0 0; padding-left: 1.5rem; line-height: 1.8;">
                          <li data-i18n="config.next_step_1">Click <strong>Save Settings</strong> button at the bottom of the sidebar</li>
                          <li data-i18n="config.next_step_2">Click the <strong>Start Bot</strong> button at the top of the page</li>
                          <li data-i18n="config.next_step_3">Once the bot is running, the dropdowns below will automatically populate with your servers and channels</li>
                        </ol>
                      </div>

                      <div class="form-group">
                        <label for="GUILD_ID" data-i18n="config.discord_server">Discord Server</label>
                        <select 
                          id="GUILD_ID" 
                          name="GUILD_ID"
                          style="width: 100%; background-color: var(--background); border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                          <option value="" data-i18n="config.loading_servers">Loading servers...</option>
                        </select>
                        <div class="form-text" data-i18n="config.discord_server_help">
                          Select the Discord server where the bot will operate. Make sure you've added the bot to your server first.
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="JELLYFIN_CHANNEL_ID" data-i18n="config.default_channel">Default Notification Channel</label>
                        <select
                          id="JELLYFIN_CHANNEL_ID"
                          name="JELLYFIN_CHANNEL_ID"
                          style="width: 100%; background-color: var(--background); border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                          <option value="" data-i18n="config.select_server_first">Select a server first...</option>
                        </select>
                        <div class="form-text" data-i18n="config.default_channel_help">
                          Select the default Discord channel for Jellyfin notifications. You can override this per-library in Step 4. Choose a server above first.
                        </div>
                      </div>

                    </fieldset>
                  </div>

                  <!-- Jellyseerr Pane -->
                  <div id="config-pane-jellyseerr" class="config-pane">
                    <fieldset>
                      <legend data-i18n="config.jellyseerr_section">Jellyseerr Settings</legend>
                      <div class="form-group">
                        <label for="JELLYSEERR_URL" data-i18n="config.jellyseerr_url">Jellyseerr URL</label>
                        <input
                          type="text"
                          id="JELLYSEERR_URL"
                          name="JELLYSEERR_URL"
                          placeholder="http://localhost:5055"
                        />
                        <div class="form-text" data-i18n="config.jellyseerr_url_help">
                          The full URL of your Jellyseerr instance.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="JELLYSEERR_API_KEY" data-i18n="config.jellyseerr_api_key"
                          >Jellyseerr API Key</label
                        >
                        <input
                          type="password"
                          id="JELLYSEERR_API_KEY"
                          name="JELLYSEERR_API_KEY"
                          placeholder="MTc2MjA6************************PljQTg6YpQ5Yzg2Nw=="
                        />
                        <div class="form-text" data-i18n="config.jellyseerr_api_key_help">
                          Your API key from Jellyseerr settings
                        </div>
                      </div>
                      <div class="form-group">
                        <button type="button" id="test-jellyseerr-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem;" data-i18n="config.test_connection">Test Connection</button>
                        <span
                          id="test-jellyseerr-status"
                          style="margin-left: 1rem;"
                        ></span>
                      </div>

                      <!-- Default Quality Profiles Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.1rem; font-weight: 700; color: var(--mauve);">
                          <strong data-i18n="config.default_quality_profiles">Default Quality Profiles (Optional)</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;" data-i18n="config.default_quality_profiles_help">
                          Set default quality profiles and servers for media requests. These will be used when users don't specify a profile via the <code>/request</code> command.
                        </div>
                        
                        <div class="form-group">
                          <button type="button" id="load-jellyseerr-options-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem; margin: 0;" data-i18n="config.load_profiles_servers">
                            Load Profiles & Servers
                          </button>
                          <span id="load-jellyseerr-options-status" style="margin-left: 1rem;"></span>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem;">
                          <!-- Default Movie Quality Profile -->
                          <div class="form-group">
                            <label for="DEFAULT_QUALITY_PROFILE_MOVIE" style="display: block; margin-bottom: 0.5rem; font-weight: 600;" data-i18n="config.default_movie_quality">ðŸŽ¬ Default Movie Quality</label>
                            <select id="DEFAULT_QUALITY_PROFILE_MOVIE" name="DEFAULT_QUALITY_PROFILE_MOVIE" style="width: 100%; background-color: #1e1e2e; border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                              <option value="" data-i18n="config.use_jellyseerr_default">Use Jellyseerr default</option>
                            </select>
                            <div class="form-text" style="margin-top: 0.25rem;" data-i18n="config.default_movie_quality_help">
                              Quality profile for movie requests (Radarr)
                            </div>
                          </div>

                          <!-- Default TV Quality Profile -->
                          <div class="form-group">
                            <label for="DEFAULT_QUALITY_PROFILE_TV" style="display: block; margin-bottom: 0.5rem; font-weight: 600;" data-i18n="config.default_tv_quality">ðŸ“º Default TV Quality</label>
                            <select id="DEFAULT_QUALITY_PROFILE_TV" name="DEFAULT_QUALITY_PROFILE_TV" style="width: 100%; background-color: #1e1e2e; border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                              <option value="" data-i18n="config.use_jellyseerr_default">Use Jellyseerr default</option>
                            </select>
                            <div class="form-text" style="margin-top: 0.25rem;" data-i18n="config.default_tv_quality_help">
                              Quality profile for TV show requests (Sonarr)
                            </div>
                          </div>

                          <!-- Default Movie Server -->
                          <div class="form-group">
                            <label for="DEFAULT_SERVER_MOVIE" style="display: block; margin-bottom: 0.5rem; font-weight: 600;" data-i18n="config.default_movie_server">ðŸŽ¬ Default Movie Server</label>
                            <select id="DEFAULT_SERVER_MOVIE" name="DEFAULT_SERVER_MOVIE" style="width: 100%; background-color: #1e1e2e; border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                              <option value="" data-i18n="config.use_jellyseerr_default">Use Jellyseerr default</option>
                            </select>
                            <div class="form-text" style="margin-top: 0.25rem;" data-i18n="config.default_movie_server_help">
                              Radarr server for movie requests
                            </div>
                          </div>

                          <!-- Default TV Server -->
                          <div class="form-group">
                            <label for="DEFAULT_SERVER_TV" style="display: block; margin-bottom: 0.5rem; font-weight: 600;" data-i18n="config.default_tv_server">ðŸ“º Default TV Server</label>
                            <select id="DEFAULT_SERVER_TV" name="DEFAULT_SERVER_TV" style="width: 100%; background-color: #1e1e2e; border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                              <option value="" data-i18n="config.use_jellyseerr_default">Use Jellyseerr default</option>
                            </select>
                            <div class="form-text" style="margin-top: 0.25rem;" data-i18n="config.default_tv_server_help">
                              Sonarr server for TV show requests
                            </div>
                          </div>
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Media Databases Pane -->
                  <div id="config-pane-media" class="config-pane">
                    <fieldset>
                      <legend data-i18n="config.media_section">Media Database Settings</legend>
                      <div class="form-group">
                        <label for="TMDB_API_KEY" data-i18n="config.tmdb_api_key">TMDB API Key</label>
                        <input
                          type="text"
                          id="TMDB_API_KEY"
                          name="TMDB_API_KEY"
                          placeholder="f94a3e627b8a545201e2531b62087b47"
                        />
                        <div class="form-text" data-i18n="config.tmdb_api_key_help">
                          A 
                          <a
                            href="https://www.themoviedb.org/settings/api"
                            target="_blank"
                            rel="noopener noreferrer"
                            >TMDB API Key</a
                          >
                          is required for searching and fetching
                          movie/show details. Found in the
                          <a
                            href="https://www.themoviedb.org/settings/api"
                            target="_blank"
                            rel="noopener noreferrer"
                            >API settings page of your TMDB account</a
                          >
                          after you log in.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="OMDB_API_KEY" data-i18n="config.omdb_api_key"
                          >OMDb API Key (Optional)</label
                        >
                        <input
                          type="text"
                          id="OMDB_API_KEY"
                          name="OMDB_API_KEY"
                          placeholder="e23eb6be"
                        />
                        <div class="form-text" data-i18n="config.omdb_api_key_help">
                          Optional, but recommended for richer data like ratings
                          and directors. Create one on the
                          <a
                            href="https://www.omdbapi.com/apikey.aspx"
                            target="_blank"
                            rel="noopener noreferrer"
                            >API Key page of OMDb</a
                          >.
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Jellyfin Notifications Pane -->
                  <div id="config-pane-jellyfin" class="config-pane">
                    <fieldset>
                      <legend data-i18n="config.jellyfin_section">Jellyfin Notification Settings</legend>
                      <div class="form-group">
                        <label for="JELLYFIN_BASE_URL" data-i18n="config.jellyfin_url"
                          >Jellyfin Public URL</label
                        >
                        <input
                          type="text"
                          id="JELLYFIN_BASE_URL"
                          name="JELLYFIN_BASE_URL"
                          placeholder="http://jellyfin.yourdomain.com  |  http://192.168.1.1:8096"
                        />
                        <div class="form-text" data-i18n="config.jellyfin_url_help">
                          The public URL of your Jellyfin server. Used for the
                          "Watch Now" button.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="JELLYFIN_API_KEY" data-i18n="config.jellyfin_api_key"
                          >Jellyfin API Key</label
                        >
                        <input
                          type="password"
                          id="JELLYFIN_API_KEY"
                          name="JELLYFIN_API_KEY"
                          placeholder="c4b6b3c8****************e4d8f1b3c7a9"
                        />
                        <div class="form-text" data-i18n="config.jellyfin_api_key_help">
                          API key for your Jellyfin server. Generate one in Jellyfin Dashboard â†’ Administration â†’ API Keys. Required for loading libraries and enhanced features.
                        </div>
                      </div>
                      <div class="form-group">
                        <button type="button" id="test-jellyfin-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem;" data-i18n="config.test_endpoint">Test Endpoint</button>
                        <span
                          id="test-jellyfin-status"
                          style="margin-left: 1rem;"
                        ></span>
                        <div class="form-text" style="margin-top: 0.5rem;" data-i18n="config.test_endpoint_help">
                          Testing the endpoint successfully will automatically populate the Jellyfin Server ID field.
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="JELLYFIN_SERVER_ID" data-i18n="config.jellyfin_server_id"
                          >Jellyfin Server ID</label
                        >
                        <input
                          type="text"
                          id="JELLYFIN_SERVER_ID"
                          name="JELLYFIN_SERVER_ID"
                          placeholder="c1507dcd594b404a8e668ba38f8eaa0c"
                        />
                        <div class="form-text" data-i18n="config.jellyfin_server_id_help">
                          Used for redirecting to the correct path of your
                          Jellyfin server media page when using the "Watch Now"
                          button. You can find this in your Jellyfin URL when
                          viewing the page of any movie or show from your
                          library.
                        </div>
                      </div>

                      <!-- Episode Debouncing Section -->
                      <div class="form-group" style="margin-top: 1.5rem;">
                        <label for="WEBHOOK_DEBOUNCE_SECONDS" style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          Episode Notification Debounce
                        </label>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                          <div style="position: relative; display: inline-block;">
                            <input
                              type="number"
                              id="WEBHOOK_DEBOUNCE_SECONDS"
                              value="60"
                              min="1"
                              max="600"
                              step="1"
                              style="width: 60px; background-color: var(--surface0); border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem 3rem 0.75rem 1rem; border-radius: 8px; font-size: 1rem; font-weight: 500; appearance: textfield; -moz-appearance: textfield;"
                            />
                            <style>
                              #WEBHOOK_DEBOUNCE_SECONDS::-webkit-outer-spin-button,
                              #WEBHOOK_DEBOUNCE_SECONDS::-webkit-inner-spin-button {
                                -webkit-appearance: none;
                                margin: 0;
                              }
                              .debounce-arrows {
                                position: absolute;
                                right: 8px;
                                top: 50%;
                                transform: translateY(-50%);
                                display: flex;
                                gap: 4px;
                              }
                              .debounce-arrow {
                                width: 24px;
                                height: 24px;
                                background-color: var(--surface1);
                                border: 1px solid var(--surface2);
                                border-radius: 4px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                cursor: pointer;
                                transition: all 0.2s ease;
                                user-select: none;
                              }
                              .debounce-arrow:hover {
                                background-color: var(--surface2);
                                border-color: var(--mauve);
                              }
                              .debounce-arrow:active {
                                background-color: var(--mauve);
                                transform: scale(0.95);
                              }
                              .debounce-arrow svg {
                                width: 12px;
                                height: 12px;
                                fill: var(--text);
                              }
                              .debounce-arrow:hover svg {
                                fill: var(--mauve);
                              }
                              .debounce-arrow:active svg {
                                fill: var(--crust);
                              }
                            </style>
                            <div class="debounce-arrows">
                              <div class="debounce-arrow" id="debounce-down" title="Decrease">
                                <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/></svg>
                              </div>
                              <div class="debounce-arrow" id="debounce-up" title="Increase">
                                <svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
                              </div>
                            </div>
                          </div>
                          <span style="color: var(--subtext0); font-weight: 500; font-size: 1rem;">seconds <span style="opacity: 0.7; font-size: 0.9rem;">(range: 1 second - 10 minutes)</span></span>
                        </div>
                        <input type="hidden" id="WEBHOOK_DEBOUNCE_MS" name="WEBHOOK_DEBOUNCE_MS" value="60000" />
                        <div class="form-text" style="margin-top: 0.5rem;">
                          Debounce function to determine how long to wait before sending notifications for multiple episodes/seasons, bundling them into a single notification message.
                        </div>
                      </div>

                      <!-- Library Notifications Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          <strong>Library Channel Mapping</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;">
                          Map specific Jellyfin libraries to different Discord channels.
                          <br>
                          <small style="color: var(--subtext0);">
                            Click "Fetch Libraries" to load your libraries, then select a channel for each one.
                            <br><strong>Note:</strong> Unchecked libraries will not send any notifications.
                          </small>
                        </div>
                        <button type="button" id="fetch-libraries-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem; margin: 0 0 1rem 0; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;">
                          <i class="bi bi-arrow-clockwise"></i> Fetch Libraries
                        </button>
                        <span id="fetch-libraries-status" style="margin-left: 1rem;"></span>
                        
                        <div id="libraries-list" class="libraries-container">
                          <!-- Populated dynamically -->
                        </div>
                        <input type="hidden" id="JELLYFIN_NOTIFICATION_LIBRARIES" name="JELLYFIN_NOTIFICATION_LIBRARIES" />
                        
                        <!-- Hidden inputs for episodes/seasons notify flags -->
                        <input type="hidden" id="JELLYFIN_NOTIFY_EPISODES" name="JELLYFIN_NOTIFY_EPISODES" value="" />
                        <input type="hidden" id="JELLYFIN_NOTIFY_SEASONS" name="JELLYFIN_NOTIFY_SEASONS" value="" />
                        <input type="hidden" id="JELLYFIN_EPISODE_CHANNEL_ID" name="JELLYFIN_EPISODE_CHANNEL_ID" value="" />
                        <input type="hidden" id="JELLYFIN_SEASON_CHANNEL_ID" name="JELLYFIN_SEASON_CHANNEL_ID" value="" />
                      </div>

                      <!-- Webhook Section -->
                      <div id="webhook-section" class="webhook-box" style="margin-top: 2rem;">
                        <h3 class="webhook-title">Your Jellyfin Webhook URL</h3>
                        <div class="webhook-content">
                          <p>
                            To receive notifications, add this URL to your <strong class="emphasis-mauve">Jellyfin Webhooks plugin</strong> settings:
                          </p>
                          <div class="webhook-url-container">
                            <code id="webhook-url" class="code-block"></code>
                            <button
                              type="button"
                              id="copy-webhook-btn"
                              class="btn btn-secondary"
                            >Copy URL</button>
                          </div>
                          <p style="margin-top: 0.75rem; font-size: 0.9rem; opacity: 0.8;">
                            <strong data-i18n="jellyfin_webhook.note">Note:</strong> If you're running Anchorr in Docker, you may need to replace <code>localhost</code> with your server's IP address.
                          </p>
                          <p style="margin-top: 1.5rem;" data-i18n="jellyfin_webhook.plugin_install">If you don't have the plugin installed, access the <strong class="emphasis-mauve">Plugins page</strong> in your <strong class="emphasis-mauve">Jellyfin Dashboard</strong>, search for <strong class="emphasis-mauve">Webhook</strong>, install it and restart the server.</p>
                          <p data-i18n="jellyfin_webhook.plugin_setup">After the reset, access your <strong class="emphasis-mauve">Webhook plugin settings</strong> and <strong class="emphasis-mauve">Add Discord Destination</strong>.</p>
                          <ol style="padding-left: 1.5rem; opacity: 0.9;">
                            <li data-i18n="jellyfin_webhook.step_server_url">Complete the <strong class="emphasis-mauve">Server Url</strong> with your Jellyfin server's base URL.</li>
                            <li data-i18n="jellyfin_webhook.step_webhook_url">Insert the previously specified URL in the <strong class="emphasis-mauve">Webhook Url</strong> field.</li>
                            <li data-i18n="jellyfin_webhook.step_status"><strong class="emphasis-mauve">Status</strong> must be <strong class="emphasis-mauve">Enabled</strong>.</li>
                            <li data-i18n="jellyfin_webhook.step_notification_type">For <strong class="emphasis-mauve">Notification Type</strong> enable <strong class="emphasis-mauve">Item Added</strong>.</li>
                            <li data-i18n="jellyfin_webhook.step_item_type">For <strong class="emphasis-mauve">Item Type</strong> select your desired content you want to receive notifications for.</li>
                            <li data-i18n="jellyfin_webhook.step_properties">Enable <strong class="emphasis-mauve">Send All Properties</strong>.</li>
                            <li data-i18n="jellyfin_webhook.step_save"><strong class="emphasis-mauve">Save</strong>.</li>
                          </ol>
                        </div>
                      </div>

                      <!-- Embed Customization Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          <strong>Embed Customization</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;">
                          Customize which elements appear in your Discord notification embeds.
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_BACKDROP" name="EMBED_SHOW_BACKDROP" checked>
                            <label class="form-check-label" for="EMBED_SHOW_BACKDROP" style="margin-left: 0.5rem;">
                              <strong>Backdrop Image</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Large background image</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_OVERVIEW" name="EMBED_SHOW_OVERVIEW" checked>
                            <label class="form-check-label" for="EMBED_SHOW_OVERVIEW" style="margin-left: 0.5rem;">
                              <strong>Overview/Description</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Plot summary text</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_GENRE" name="EMBED_SHOW_GENRE" checked>
                            <label class="form-check-label" for="EMBED_SHOW_GENRE" style="margin-left: 0.5rem;">
                              <strong>Genre</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Genre field</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_RUNTIME" name="EMBED_SHOW_RUNTIME" checked>
                            <label class="form-check-label" for="EMBED_SHOW_RUNTIME" style="margin-left: 0.5rem;">
                              <strong>Runtime</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Duration field</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_RATING" name="EMBED_SHOW_RATING" checked>
                            <label class="form-check-label" for="EMBED_SHOW_RATING" style="margin-left: 0.5rem;">
                              <strong>Rating</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">IMDB/TMDB rating</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_BUTTON_LETTERBOXD" name="EMBED_SHOW_BUTTON_LETTERBOXD" checked>
                            <label class="form-check-label" for="EMBED_SHOW_BUTTON_LETTERBOXD" style="margin-left: 0.5rem;">
                              <strong>Letterboxd Button</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Link to Letterboxd</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_BUTTON_IMDB" name="EMBED_SHOW_BUTTON_IMDB" checked>
                            <label class="form-check-label" for="EMBED_SHOW_BUTTON_IMDB" style="margin-left: 0.5rem;">
                              <strong>IMDb Button</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Link to IMDb</div>
                            </label>
                          </div>

                          <div class="form-check form-switch" style="padding: 0.75rem; background-color: var(--surface0); border-radius: 8px;">
                            <input class="form-check-input" type="checkbox" id="EMBED_SHOW_BUTTON_WATCH" name="EMBED_SHOW_BUTTON_WATCH" checked>
                            <label class="form-check-label" for="EMBED_SHOW_BUTTON_WATCH" style="margin-left: 0.5rem;">
                              <strong>Watch Now Button</strong>
                              <div style="font-size: 0.85rem; color: var(--subtext0); margin-top: 0.25rem;">Link to Jellyfin</div>
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Notification Testing Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          <strong>Notification Testing</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;">
                          Test your notification templates by sending sample notifications to your Discord channel. This helps you preview how different types of notifications will appear.
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                          <button type="button" id="test-movie-notification-btn" class="btn btn-secondary" style="padding: 0.75rem 1rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="bi bi-film"></i> Test Movie
                          </button>
                          <button type="button" id="test-series-notification-btn" class="btn btn-secondary" style="padding: 0.75rem 1rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="bi bi-tv"></i> Test Series
                          </button>
                          <button type="button" id="test-season-notification-btn" class="btn btn-secondary" style="padding: 0.75rem 1rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="bi bi-collection"></i> Test Season
                          </button>
                          <button type="button" id="test-batch-seasons-notification-btn" class="btn btn-secondary" style="padding: 0.75rem 1rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="bi bi-collection-fill"></i> Test Seasons Batch
                          </button>
                          <button type="button" id="test-episodes-notification-btn" class="btn btn-secondary" style="padding: 0.75rem 1rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="bi bi-collection-play"></i> Test Episodes
                          </button>
                          <button type="button" id="test-batch-episodes-notification-btn" class="btn btn-secondary" style="padding: 0.75rem 1rem; margin: 0; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="bi bi-collection-play-fill"></i> Test Episodes Batch
                          </button>
                        </div>
                        
                        <div id="test-notification-status" style="margin-top: 1rem;"></div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Network Pane -->
                  <!-- User Mappings Pane -->
                  <div id="config-pane-mappings" class="config-pane">
                    <fieldset>
                      <legend>User Mapping</legend>
                      <p class="form-text" style="margin-bottom: 1.5rem;">
                        Map Discord users to their Jellyseerr accounts. When a user makes a request from Discord, it will be associated with their Jellyseerr account instead of the API key owner.
                      </p>
                      
                      <div id="mappings-container">
                        <div class="mappings-list" id="mappings-list">
                          <!-- Mappings will be populated here -->
                        </div>
                        
                        <div class="add-mapping-form" style="margin-top: 1.5rem;">
                          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                            <h4 style="font-size: 1.1rem; margin: 0; color: var(--mauve); line-height: 1.4;">Add New Mapping</h4>
                            <button type="button" id="refresh-all-users-btn" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 0.4rem; margin: 0; height: fit-content;">
                              <i class="bi bi-arrow-clockwise"></i> Refresh Users
                            </button>
                          </div>
                          <div class="form-group">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                              <label for="discord-user-select" style="margin-bottom: 0;">Discord User</label>
                            </div>
                            <div class="custom-select" id="discord-user-select">
                              <input type="text" class="custom-select-trigger" placeholder="Search Discord users..." readonly />
                              <i class="bi bi-chevron-down custom-select-chevron"></i>
                              <div class="custom-select-dropdown">
                                <div class="custom-select-options">
                                  <!-- Options will be populated here -->
                                </div>
                              </div>
                            </div>
                            <div class="form-text">
                              Select a Discord server member
                            </div>
                          </div>
                          <div class="form-group">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                              <label for="jellyseerr-user-select" style="margin-bottom: 0;">Jellyseerr User</label>
                            </div>
                            <div class="custom-select" id="jellyseerr-user-select">
                              <input type="text" class="custom-select-trigger" placeholder="Search Jellyseerr users..." readonly />
                              <i class="bi bi-chevron-down custom-select-chevron"></i>
                              <div class="custom-select-dropdown">
                                <div class="custom-select-options">
                                  <!-- Options will be populated here -->
                                </div>
                              </div>
                            </div>
                            <div class="form-text">
                              Select the corresponding Jellyseerr account
                            </div>
                          </div>
                          <button type="button" id="add-mapping-btn" class="btn btn-primary" style="margin-left: 0;">Add Mapping</button>
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Role Permissions Pane -->
                  <div id="config-pane-roles" class="config-pane">
                    <fieldset>
                      <legend>Role Permissions</legend>
                      <p class="form-text" style="margin-bottom: 1.5rem;">
                        Control who can use bot commands by configuring role-based permissions. If no roles are selected in the allowlist, everyone can use commands. If any role is added to the blocklist, members with that role will be blocked regardless of allowlist settings.
                      </p>
                      
                      <div class="form-group">
                        <label style="font-weight: 600; color: var(--green);">Allowlist (Allow Only These Roles)</label>
                        <div id="allowlist-roles" class="role-list">
                          <p class="form-text" style="opacity: 0.7; font-style: italic;">Loading roles...</p>
                        </div>
                        <div class="form-text">
                          If empty, all members can use commands. If roles are selected, only members with these roles can use commands.
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label style="font-weight: 600; color: var(--peach);">Blocklist (Block These Roles)</label>
                        <div id="blocklist-roles" class="role-list">
                          <p class="form-text" style="opacity: 0.7; font-style: italic;">Loading roles...</p>
                        </div>
                        <div class="form-text">
                          Members with these roles will never be able to use bot commands, even if they have an allowed role.
                        </div>
                      </div>
                    </fieldset>
                  </div>

                  <!-- Miscellaneous Pane -->
                  <div id="config-pane-misc" class="config-pane">
                    <fieldset>
                      <legend>Miscellaneous Settings</legend>
                      <p class="form-text" style="margin-bottom: 1.5rem;">
                        Optional settings to enhance your bot experience. These are extra features that can be enabled after your bot is fully configured and running.
                      </p>
                      
                      <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                          <input type="checkbox" id="AUTO_START_BOT" name="AUTO_START_BOT" />
                          Auto-start bot on server boot
                        </label>
                        <div class="form-text">
                          If enabled, the bot starts automatically when the container/server restarts and valid Discord credentials are present.
                        </div>
                      </div>

                      <div class="form-group" style="margin-top: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                          <input type="checkbox" id="NOTIFY_ON_AVAILABLE" name="NOTIFY_ON_AVAILABLE" />
                          Send PM when request is available
                        </label>
                        <div class="form-text">
                          When enabled, users will receive a private message when their requested content becomes available on Jellyfin.
                        </div>
                      </div>

                      <div class="form-group" style="margin-top: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                          <input type="checkbox" id="PRIVATE_MESSAGE_MODE" name="PRIVATE_MESSAGE_MODE" />
                          Ephemeral Message Mode
                        </label>
                        <div class="form-text">
                          When enabled, all bot responses (search and request results) are sent as ephemeral messages (only visible to the user who used the command). When disabled, successful results are visible to everyone in the channel, but warning messages (e.g., "already on Jellyfin") are always ephemeral.
                        </div>
                      </div>

                      <!-- Discord Embed Colors Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          <strong>Discord Embed Colors</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;">
                          Customize the colors of Discord notification embeds for different content types.
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                          <!-- Movie Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_MOVIE" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸŽ¬ Movies</label>
                            <input type="text" id="EMBED_COLOR_MOVIE" name="EMBED_COLOR_MOVIE" data-coloris value="#cba6f7" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Series Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_SERIES" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸ“º TV Series</label>
                            <input type="text" id="EMBED_COLOR_SERIES" name="EMBED_COLOR_SERIES" data-coloris value="#cba6f7" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Season Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_SEASON" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸ“º Seasons</label>
                            <input type="text" id="EMBED_COLOR_SEASON" name="EMBED_COLOR_SEASON" data-coloris value="#89b4fa" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Single Episode Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_EPISODE_SINGLE" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸ“º Single Episode</label>
                            <input type="text" id="EMBED_COLOR_EPISODE_SINGLE" name="EMBED_COLOR_EPISODE_SINGLE" data-coloris value="#89b4fa" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Few Episodes Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_EPISODE_FEW" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸ“º Few Episodes (2-5)</label>
                            <input type="text" id="EMBED_COLOR_EPISODE_FEW" name="EMBED_COLOR_EPISODE_FEW" data-coloris value="#89b4fa" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Many Episodes Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_EPISODE_MANY" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸ“º Many Episodes (6+)</label>
                            <input type="text" id="EMBED_COLOR_EPISODE_MANY" name="EMBED_COLOR_EPISODE_MANY" data-coloris value="#89b4fa" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Search Result Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_SEARCH" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">ðŸ” Search Results</label>
                            <input type="text" id="EMBED_COLOR_SEARCH" name="EMBED_COLOR_SEARCH" data-coloris value="#fab387" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>

                          <!-- Request Success Color -->
                          <div class="color-picker-group">
                            <label for="EMBED_COLOR_SUCCESS" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">âœ… Request Success</label>
                            <input type="text" id="EMBED_COLOR_SUCCESS" name="EMBED_COLOR_SUCCESS" data-coloris value="#a6e3a1" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--surface1); background-color: var(--surface0); color: var(--text); font-size: 1rem;" />
                          </div>
                        </div>
                      </div>

                      <!-- App Settings Section -->
                      <div class="form-group" style="margin-top: 2rem;">
                        <label style="font-size: 1.2rem; font-weight: 700; color: var(--mauve);">
                          <strong>App Settings</strong>
                        </label>
                        <div class="form-text" style="margin-bottom: 1rem;">
                          General application settings for Anchorr.
                        </div>

                        <div class="form-group">
                          <label for="app-language" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Language</label>
                          <select id="app-language" name="LANGUAGE" style="width: 100%; max-width: 300px; background-color: #1e1e2e; border: 1px solid var(--surface1); color: var(--text); padding: 0.75rem; border-radius: 8px; font-size: 1rem;">
                            <!-- Languages will be populated dynamically -->
                          </select>
                          <div class="form-text" style="margin-top: 0.5rem;">
                            Select the language for the Anchorr dashboard interface.
                          </div>
                        </div>
                      </div>
                    </fieldset>
                  </div>

                </form>
              </div>
          </div>

          <!-- About Page (Independent) -->
          <div id="about-page" class="about-page" style="display: none;">
            <div class="about-content">
              <h2 data-i18n="about.title">About Anchorr</h2>
              <p class="about-description" data-i18n="about.description">
                <strong class="anchor-highlight">Anchorr</strong> is a self-hosted, lightweight bridge that connects your <strong style="color: var(--blue);">Jellyfin</strong> media server with <strong style="color: var(--blue);">Discord</strong>. It notifies you on a dedicated channel when new media is added to your library, and with <strong style="color: var(--blue);">Jellyseerr</strong> integration, you can search and request movies and shows directly from Discord.
              </p>

              <div class="features-list">
                <h3 class="features-title" data-i18n="about.features_title">Features</h3>
                <ul>
                  <li><i class="bi bi-search"></i><div data-i18n="about.feature_search"><code>/search &lt;title&gt;</code> Search for a movie or show with auto-suggestions. An embed with detailed information is shown, from which you can request the media. For <strong style="color: var(--blue);">TV shows</strong>, you have the option to select the desired seasons for the request.</div></li>
                  <li><i class="bi bi-send-fill"></i><div data-i18n="about.feature_request"><code>/request &lt;title&gt;</code> Instantly send a request for your chosen movie or show directly to <strong style="color: var(--blue);">Jellyseerr</strong>. For <strong style="color: var(--blue);">TV shows</strong>, this automatically requests all seasons.</div></li>
                  <li><i class="bi bi-bell-fill"></i><div data-i18n="about.feature_notifications">Receive beautifully formatted notifications on your selected <strong style="color: var(--blue);">Discord</strong> channel whenever new media is added to your <strong style="color: var(--blue);">Jellyfin</strong> library.</div></li>
                  <li><i class="bi bi-film"></i><div data-i18n="about.feature_databases">Using the <strong style="color: var(--blue);">TMDB</strong> and <strong style="color: var(--blue);">OMDb</strong> databases, <strong style="color: var(--blue);">Discord</strong> messages get a beautiful and well-structured look, with essential information about the requested or added media content.</div></li>
                  <li><i class="bi bi-sliders"></i><div data-i18n="about.feature_permissions">Control permissions with <strong style="color: var(--blue);">role-based access</strong> (allowlist/blocklist), route notifications to different channels by <strong style="color: var(--blue);">Jellyfin library</strong>, and link users to <strong style="color: var(--blue);">Jellyseerr</strong> accounts for accurate request tracking.</div></li>
                  <li><i class="bi bi-chat-left-dots"></i><div data-i18n="about.feature_direct_messages">Get <strong style="color: var(--blue);">direct messages</strong> on <strong style="color: var(--blue);">Discord</strong> when requested content becomes available in your library. Never miss when your requests are ready!</div></li>
                </ul>
              </div>

              <div class="about-cards">
                <div class="about-card support-card">
                  <i class="bi bi-heart-fill"></i>
                  <h3 data-i18n="about.support_title">Support the Project</h3>
                  <p data-i18n="about.support_description">If you find Anchorr useful, consider supporting its development. Every coffee helps fuel late-night coding sessions!</p>
                  <a href="https://ko-fi.com/nairdah" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" data-i18n="about.buy_coffee">Buy me a Coffee</a>
                </div>
                <div class="about-card contribute-card">
                  <i class="bi bi-github"></i>
                  <h3 data-i18n="about.contribute_title">Contribute</h3>
                  <p data-i18n="about.contribute_description">Anchorr is open-source! If you're a developer, your contributions are welcome. Check out the project on GitHub to get started.</p>
                  <a href="https://github.com/nairdahh/Anchorr" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" data-i18n="about.view_github">View on GitHub</a>
                </div>
              </div>

              <div class="dev-footer">
                <div class="dev-footer-left">
                  <a href="https://nairdah.me/" target="_blank" rel="noopener noreferrer">
                    <img src="/assets/nairdah_avatar.jpeg" alt="nairdah's avatar" class="dev-avatar">
                  </a>
                  <div class="dev-info">
                    <span>Created & Maintained by</span>
                    <a href="https://nairdah.me/" target="_blank" rel="noopener noreferrer" class="dev-link">nairdah</a>
                  </div>
                </div>
                <div class="dev-footer-right">
                  <p>Thank you for using Anchorr!<br>Please contact me for any matter about the project.</p>
                </div>
              </div>

              <div class="version-footer">
                <p>Anchorr <span class="version-number">v1.3.4</span></p>
              </div>

            </div>
          </div>

        </section>
      </main>

      <!-- Logs Section -->
      <section id="logs-section" class="setup-section" style="display: none;">
        <div class="container">
          <div style="margin-bottom: 1rem; flex-shrink: 0;">
            <button type="button" id="back-to-config-btn" data-i18n="logs.back_to_config">
              â† Back to Configuration
            </button>
          </div>

          <div class="dashboard-header">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <button type="button" class="logs-tab-btn active" data-target="all" data-i18n="logs.all_logs">
                All Logs
              </button>
              <button type="button" class="logs-tab-btn" data-target="error" data-i18n="logs.errors">
                Errors
              </button>
              <button type="button" id="refresh-logs-btn" class="logs-tab-btn" title="Refresh logs" data-i18n="logs.refresh" data-i18n-attr="title">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
            </div>
            <div style="display: flex; align-items: center; gap: 1.5rem;">
              <!-- Status Indicators -->
              <div class="status-indicator-container">
                <div class="status-indicator-item">
                  <div id="jellyseerr-status-indicator" class="status-dot"></div>
                  <span>Jellyseerr</span>
                </div>
                <div class="status-indicator-item">
                  <div id="jellyfin-status-indicator" class="status-dot"></div>
                  <span>Jellyfin</span>
                </div>
              </div>
              <button type="button" id="bot-control-btn-logs" class="btn btn-status btn-danger">
                <i class="bi bi-play-fill"></i>
                <span id="bot-control-text-logs" data-i18n="config.start_bot">Start Bot</span>
              </button>
            </div>
          </div>

          <div id="logs-container">
            <div style="text-align: center; color: var(--subtext0); padding: 2rem;" data-i18n="logs.loading">
              Loading logs...
            </div>
          </div>
        </div>
      </section>

      </main>

      <footer class="footer">
        <div
          class="container"
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <div class="footer-links" style="margin-top: 0">
            <a
              href="https://github.com/nairdahh/Anchorr/issues"
              target="_blank"
              rel="noopener noreferrer"
              data-i18n="footer.report_bug"
              >Report a Bug</a
            >
            <button id="logs-page-btn" class="footer-btn" data-i18n="footer.logs">Logs</button>
          </div>
          <div>
            <span data-i18n="footer.made_by">made by</span>
            <a
              href="https://nairdah.me/"
              target="_blank"
              rel="noopener noreferrer"
              >nairdah</a
            >
            â¤ï¸
            <a
              href="https://ko-fi.com/nairdah"
              target="_blank"
              rel="noopener noreferrer"
              data-i18n="footer.buy_coffee"
              >Buy me a Coffee!</a
            >
          </div>
        </div>
      </footer>

    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
    <script src="script.js"></script>
    <script>
      // Initialize Coloris globally on page load
      document.addEventListener("DOMContentLoaded", () => {
        Coloris({
          el: "[data-coloris]",
          theme: "large",
          themeMode: "dark",
          format: "hex",
          swatches: [
            "#cba6f7", // Mauve
            "#89b4fa", // Blue
            "#a6e3a1", // Green
            "#ef9f76", // Peach
            "#f38ba8", // Red
            "#f9e2af", // Yellow
          ],
        });

        // Sync debounce seconds input with milliseconds hidden field
        const secondsInput = document.getElementById('WEBHOOK_DEBOUNCE_SECONDS');
        const msInput = document.getElementById('WEBHOOK_DEBOUNCE_MS');
        const upArrow = document.getElementById('debounce-up');
        const downArrow = document.getElementById('debounce-down');
        
        if (secondsInput && msInput) {
          // Convert seconds to milliseconds on input
          secondsInput.addEventListener('input', function() {
            let seconds = parseInt(this.value) || 60;
            // Clamp to valid range
            if (seconds < 1) seconds = 1;
            if (seconds > 600) seconds = 600;
            this.value = seconds;
            msInput.value = seconds * 1000;
          });
          
          // Hold-to-repeat functionality
          let repeatInterval = null;
          let repeatTimeout = null;
          
          const startRepeat = function(direction) {
            const increment = function() {
              let current = parseInt(secondsInput.value) || 60;
              if (direction === 'up' && current < 600) {
                secondsInput.value = current + 1;
                msInput.value = (current + 1) * 1000;
              } else if (direction === 'down' && current > 1) {
                secondsInput.value = current - 1;
                msInput.value = (current - 1) * 1000;
              }
            };
            
            // Immediate increment on first click
            increment();
            
            // Start repeating after 300ms delay at max speed (50ms interval)
            repeatTimeout = setTimeout(function() {
              repeatInterval = setInterval(increment, 50);
            }, 300);
          };
          
          const stopRepeat = function() {
            if (repeatTimeout) {
              clearTimeout(repeatTimeout);
              repeatTimeout = null;
            }
            if (repeatInterval) {
              clearInterval(repeatInterval);
              repeatInterval = null;
            }
          };
          
          // Up arrow events
          if (upArrow) {
            upArrow.addEventListener('mousedown', () => startRepeat('up'));
            upArrow.addEventListener('mouseup', stopRepeat);
            upArrow.addEventListener('mouseleave', stopRepeat);
            upArrow.addEventListener('touchstart', (e) => {
              e.preventDefault();
              startRepeat('up');
            });
            upArrow.addEventListener('touchend', stopRepeat);
          }
          
          // Down arrow events
          if (downArrow) {
            downArrow.addEventListener('mousedown', () => startRepeat('down'));
            downArrow.addEventListener('mouseup', stopRepeat);
            downArrow.addEventListener('mouseleave', stopRepeat);
            downArrow.addEventListener('touchstart', (e) => {
              e.preventDefault();
              startRepeat('down');
            });
            downArrow.addEventListener('touchend', stopRepeat);
          }
          
          // Convert milliseconds to seconds when loading config
          // This runs when the config is loaded from the server
          const updateSecondsFromMs = function() {
            const ms = parseInt(msInput.value);
            if (!isNaN(ms) && ms > 0) {
              const seconds = Math.round(ms / 1000);
              secondsInput.value = seconds;
            }
          };
          
          // Watch for changes to the hidden field (when config loads)
          const observer = new MutationObserver(updateSecondsFromMs);
          observer.observe(msInput, { attributes: true, attributeFilter: ['value'] });
          
          // Also update immediately if there's already a value
          updateSecondsFromMs();
        }
      });
    </script>

    <!-- Bot Auto-Start Confirmation Modal -->
    <div id="bot-autostart-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="bi bi-play-circle-fill" style="color: var(--mauve);"></i> Start Bot?</h3>
        </div>
        <div class="modal-body">
          <p>You've filled all the bot's requirements. Would you like to start the bot now?</p>
          <p class="modal-note">The bot will automatically connect to Discord and start monitoring for notifications.</p>
        </div>
        <div class="modal-actions">
          <button id="modal-start-yes" class="btn btn-primary" style="background-color: var(--mauve); border-color: var(--mauve);" data-i18n="modals.start_bot_yes">
            <i class="bi bi-play-fill"></i> Yes, Start Bot
          </button>
          <button id="modal-start-no" class="btn btn-secondary" data-i18n="modals.start_bot_no">
            <i class="bi bi-x-circle"></i> No, Save Only
          </button>
        </div>
      </div>
    </div>
  </body>
</html>

